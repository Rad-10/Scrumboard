{"version":3,"file":"FileUploadItem.js","sourceRoot":"","sources":["../../../src/components/File/FileUploadItem.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  forwardRef,\n  PropsWithoutRef,\n  FC,\n  Ref,\n  ReactElement,\n  useMemo,\n  useState,\n  ReactNode\n} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport Button from '../Button';\nimport Icon from '../Icon';\nimport MenuButton from '../MenuButton';\nimport MetaList from '../MetaList';\nimport SummaryItem, {\n  StyledPrimary,\n  StyledSecondary,\n  StyledSummaryItemActions,\n  StyledVisual\n} from '../SummaryItem';\nimport Progress, { StyledProgressRing } from '../Progress';\nimport Text from '../Text';\nimport { ForwardProps, BaseProps, NoChildrenProp } from '../../types';\nimport { defaultThemeProp } from '../../theme';\nimport { useI18n } from '../../hooks';\n\nimport FileVisual from './FileVisual';\nimport { getKindFromMimeType, getMimeTypeFromFile } from './utils';\n\nexport interface FileUploadItemProps extends BaseProps, NoChildrenProp {\n  /** Name of the file. */\n  name: string;\n  /** A FileUploadVisual element to represent the file. */\n  visual?: ReactElement;\n  /** Additional information about the file. If progress prop is passed and its value is less than 100, this region is instead used for the upload progress indicator. */\n  meta?: string | string[];\n  /** When passed, will render a single icon button for yet to be or in progress uploads. Use this action to trigger xhr request termination. */\n  onCancel?: (name: FileUploadItemProps['name']) => void;\n  /** When passed, will render a single icon button or within a MenuButton if other actions are defined. */\n  onEdit?: (name: FileUploadItemProps['name']) => void;\n  /** When passed, will render a single icon button or within a MenuButton if other actions are defined. */\n  onPreview?: (name: FileUploadItemProps['name']) => void;\n  /** When passed, will render a single icon button or within a MenuButton if other actions are defined. */\n  onDownload?: (name: FileUploadItemProps['name']) => void;\n  /** When passed, will render a single icon button or within a MenuButton if other actions are defined. */\n  onDelete?: (name: FileUploadItemProps['name']) => void;\n  /**\n   * Set if there is an error uploading or processing the file. Applies error styling to the meta string passed.\n   * @default false\n   */\n  error?: boolean;\n  /** A string to be used as an image src for a attachment thumbnail. Falls back to a provided icon or the default attachment icon. */\n  thumbnail?: string;\n  /** If the attachment is in an upload state, pass progress as a number between 0-100 representing the percentage of progress. */\n  progress?: number;\n  /** The size of the file. */\n  size?: number;\n  /** A ref to the file item's HTMLLIElement. */\n  ref?: Ref<HTMLLIElement>;\n}\n\ninterface FileAction {\n  fn: (name: FileUploadItemProps['name']) => void;\n  text: string;\n  icon: string;\n}\n\nconst StyledFileUploadItem = styled(SummaryItem)<{ hasThumbnail: boolean }>(\n  ({ hasThumbnail, theme }) => {\n    return css`\n      border: 0.0625rem solid ${theme.base.palette['border-line']};\n      border-radius: calc(0.5 * ${theme.base['border-radius']});\n      background-color: ${theme.base.palette['primary-background']};\n      padding: calc(0.5 * ${theme.base.spacing});\n      min-height: 3rem;\n\n      ${StyledProgressRing} {\n        height: ${theme.components.input.height};\n        width: ${theme.components.input.height};\n      }\n\n      ${hasThumbnail &&\n      css`\n        height: calc(6rem + ${theme.base.spacing});\n        grid-row: span 2;\n        grid-template-columns: auto minmax(0, 1fr) auto;\n\n        ${StyledVisual} {\n          align-self: auto;\n          width: calc(6rem - 0.125rem);\n          height: calc(6rem - 0.125rem);\n        }\n\n        ${StyledPrimary} {\n          align-self: start;\n          margin-block-start: calc(0.5 * ${theme.base.spacing});\n        }\n\n        ${StyledSecondary} {\n          grid-area: primary;\n          align-self: center;\n          margin-block-start: calc(3 * ${theme.base.spacing});\n        }\n\n        ${StyledSummaryItemActions} {\n          align-self: start;\n        }\n      `}\n    `;\n  }\n);\n\nStyledFileUploadItem.defaultProps = defaultThemeProp;\n\nconst FileUploadItem: FC<FileUploadItemProps & ForwardProps> = forwardRef(\n  (\n    {\n      name,\n      meta,\n      error = false,\n      progress,\n      thumbnail,\n      onCancel,\n      onEdit,\n      onPreview,\n      onDownload,\n      onDelete,\n      size,\n      ...restProps\n    }: PropsWithoutRef<FileUploadItemProps>,\n    ref: FileUploadItemProps['ref']\n  ) => {\n    const t = useI18n();\n    const [thumbnailError, setThumbnailError] = useState(false);\n\n    const definedActions: FileAction[] = useMemo(\n      () =>\n        [\n          { fn: onCancel, text: t('cancel'), icon: 'times' },\n          { fn: onEdit, text: t('edit'), icon: 'pencil' },\n          { fn: onPreview, text: t('preview'), icon: 'eye' },\n          { fn: onDownload, text: t('download'), icon: 'download' },\n          { fn: onDelete, text: t('delete'), icon: 'trash' }\n        ].filter<FileAction>((action): action is FileAction => !!action.fn),\n      [onCancel, onEdit, onPreview, onDownload, onDelete]\n    );\n\n    let metaContent: ReactNode = meta;\n    let actions: ReactElement | undefined;\n\n    const type = getKindFromMimeType(getMimeTypeFromFile(name) ?? '');\n\n    if (typeof progress === 'number' && progress < 100) {\n      metaContent = `${t('uploading')}…${Math.floor(progress)}%`;\n    }\n\n    if (Array.isArray(metaContent)) {\n      metaContent = (\n        <MetaList\n          items={metaContent.map((item, i) => (\n            // eslint-disable-next-line react/no-array-index-key\n            <Text key={i} variant='secondary' status={error ? 'error' : undefined}>\n              {item}\n            </Text>\n          ))}\n        />\n      );\n    } else if (typeof metaContent === 'string') {\n      metaContent = (\n        <Text variant='secondary' status={error ? 'error' : undefined}>\n          {metaContent}\n        </Text>\n      );\n    }\n\n    if (definedActions.length === 1) {\n      const action = definedActions[0];\n\n      actions = (\n        <Button\n          icon\n          variant='simple'\n          onClick={() => action.fn?.(name)}\n          aria-label={`${action.text} ${name}`}\n        >\n          <Icon name={action.icon} />\n        </Button>\n      );\n    } else if (definedActions.length > 1) {\n      actions = (\n        <MenuButton\n          text={t('actions')}\n          iconOnly\n          icon='more'\n          variant='simple'\n          menu={{\n            items: definedActions.map(action => ({\n              id: action.text,\n              primary: action.text,\n              onClick: () => {\n                action.fn(name);\n              }\n            }))\n          }}\n        />\n      );\n    }\n\n    const visual = useMemo(() => {\n      if (typeof progress === 'number' && progress !== 100) {\n        return <Progress value={progress} placement='inline' variant='ring' />;\n      }\n\n      return (\n        <FileVisual\n          type={type}\n          thumbnail={thumbnailError ? undefined : thumbnail}\n          onThumbnailError={() => {\n            setThumbnailError(true);\n          }}\n        />\n      );\n    }, [progress, thumbnail, thumbnailError]);\n\n    return (\n      <StyledFileUploadItem\n        {...restProps}\n        forwardedAs='li'\n        hasThumbnail={\n          thumbnail && !thumbnailError && (progress === 100 || progress === undefined) && !error\n        }\n        ref={ref}\n        visual={visual}\n        primary={name}\n        secondary={metaContent}\n        actions={actions}\n        overflowStrategy='ellipsis'\n      />\n    );\n  }\n);\n\nexport default FileUploadItem;\n"]}