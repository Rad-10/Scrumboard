{"version":3,"file":"Popover.js","sourceRoot":"","sources":["../../../src/components/Popover/Popover.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  forwardRef,\n  useContext,\n  PropsWithoutRef,\n  Ref,\n  CSSProperties,\n  ReactElement,\n  useRef,\n  ReactNode,\n  useEffect,\n  useMemo,\n  useState\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport { usePopper, PopperProps } from 'react-popper';\nimport { VirtualElement } from '@popperjs/core';\nimport { OffsetModifier } from '@popperjs/core/lib/modifiers/offset';\n\nimport { BaseProps, ForwardProps } from '../../types';\nimport {\n  useAfterInitialEffect,\n  useConfiguration,\n  useConsolidatedRef,\n  useElement,\n  useUID\n} from '../../hooks';\nimport { popoverMap, windowIsAvailable } from '../../utils';\nimport { ConfigurationProps } from '../Configuration';\nimport { BackdropContext } from '../Backdrop/Backdrop';\n\nimport { PopoverManagerContext } from './PopoverContext';\nimport { StyledPopover, StyledPopoverContent, StyledPopoverArrow } from './Popover.styles';\nimport { applyMaxSize, maxSize } from './modifiers';\n\nexport type Delay = 'none' | 'short' | 'long';\nexport interface PopoverProps<Modifiers extends string = string> extends BaseProps {\n  /** The DOM element or [virtual element](https://popper.js.org/docs/v2/virtual-elements) that the Popover is positioned in reference to. */\n  target: Element | VirtualElement | null;\n  /**\n   * If true, the Popover will be visible.\n   * @default true\n   */\n  show?: boolean;\n  /**\n   * If true, the Popover will render outside of the current DOM hierarchy in a [portal](https://reactjs.org/docs/portals.html).\n   * @default true\n   */\n  portal?: boolean | ConfigurationProps['portalTarget'];\n  /**\n   * Delay on showing the Popover.\n   * @default \"none\"\n   */\n  showDelay?: Delay;\n  /**\n   * Delay on hiding the Popover.\n   * @default \"none\"\n   */\n  hideDelay?: Delay;\n  /**\n   * [React Popper Placement](https://popper.js.org/react-popper/v2/render-props/#placement)\n   */\n  placement?: PopperProps<Modifiers>['placement'];\n  /**\n   * [React Popper Strategy](https://popper.js.org/react-popper/v2/render-props/#strategy)\n   * @default \"absolute\"\n   */\n  strategy?: PopperProps<Modifiers>['strategy'];\n  /**\n   * [React Popper Modifiers](https://popper.js.org/react-popper/v2/render-props/#modifiers)\n   * @default []\n   */\n  modifiers?: PopperProps<Modifiers>['modifiers'];\n  /**\n   * If true, an arrow will visually identify from which element the Popover is rendered.\n   * @default false\n   */\n  arrow?: boolean;\n  /** The group that the Popover belongs to. Popovers in the same group will be closed when others open. */\n  groupId?: string;\n  /**\n   * If true, the Popover will be visibly hidden when its target leaves the viewport.\n   * @default false\n   */\n  hideOnTargetHidden?: boolean;\n  /** Callback that runs when the popover is hidden */\n  onHide?: () => void;\n  /** The content of the Popover. */\n  children: ReactNode;\n  /** The ref of the wrapping element. */\n  ref?: Ref<HTMLDivElement>;\n}\n\nconst delays = {\n  none: 0,\n  short: 500,\n  long: 1000\n};\n\nconst Popover: <Modifiers extends string = string>(\n  props: PopoverProps<Modifiers> & ForwardProps\n) => ReactElement | null = forwardRef(\n  (\n    {\n      show = true,\n      portal = true,\n      target,\n      placement,\n      strategy = 'fixed',\n      style,\n      modifiers = [],\n      arrow = false,\n      groupId,\n      showDelay = 'none',\n      hideDelay = 'none',\n      hideOnTargetHidden = false,\n      children,\n      onHide,\n      ...restProps\n    }: PropsWithoutRef<PopoverProps> & { style?: CSSProperties },\n    ref: PopoverProps['ref']\n  ) => {\n    const { portalTarget: configurationPortal } = useConfiguration();\n    const { el: backdropPortal } = useContext(BackdropContext);\n    const { checkActive, setActive, popovers } = useContext(PopoverManagerContext);\n    const [, setPopperEl] = useElement<HTMLDivElement>();\n    const popperRef = useConsolidatedRef<HTMLDivElement>(ref, setPopperEl);\n    const arrowRef = useRef<HTMLDivElement>(null);\n    const forceUpdateRef = useRef<() => void>();\n    const [showPopover, setShowPopover] = useState(show);\n    const timeout = useRef<number>();\n    const uid = useUID();\n    const pointerId = useUID();\n\n    const portalTarget =\n      typeof portal === 'boolean' ? backdropPortal ?? configurationPortal : portal;\n\n    const memoedModifiers = useMemo(\n      () => [\n        {\n          name: 'computeStyles',\n          options: {\n            gpuAcceleration: false\n          }\n        },\n        {\n          name: 'offset',\n          options: {\n            offset: [0, arrow ? 5.5 : 2]\n          }\n        },\n        { name: 'hide', enabled: hideOnTargetHidden },\n        { name: 'arrow', enabled: arrow, options: { element: arrowRef.current } },\n        {\n          name: 'preventOverflow',\n          options: {\n            tether: !modifiers.find(m => m.name === 'sameWidth')\n          }\n        },\n        maxSize,\n        applyMaxSize,\n        ...modifiers\n      ],\n      [modifiers, arrow, hideOnTargetHidden]\n    );\n\n    const offset = useMemo(() => {\n      const offsetModifier = [...memoedModifiers]\n        .reverse()\n        .find(m => m.name === 'offset' && m.enabled !== false) as OffsetModifier | undefined;\n      return Array.isArray(offsetModifier?.options?.offset)\n        ? offsetModifier?.options?.offset[1] ?? 0\n        : 0;\n    }, [memoedModifiers]);\n\n    const { styles, attributes, forceUpdate } = usePopper(target, popperRef.current, {\n      placement,\n      strategy,\n      modifiers: memoedModifiers\n    });\n\n    if (forceUpdate) forceUpdateRef.current = forceUpdate;\n\n    useEffect(() => {\n      const observer = new ResizeObserver(() => {\n        forceUpdateRef.current?.();\n      });\n\n      if (popperRef.current) observer.observe(popperRef.current);\n      if (target instanceof Element) observer.observe(target);\n\n      return () => {\n        observer.disconnect();\n      };\n    }, [forceUpdate, popperRef.current, target]);\n\n    useEffect(() => {\n      if (groupId && show) setActive(uid, groupId);\n\n      if (windowIsAvailable) {\n        if (timeout.current) clearTimeout(timeout.current);\n        timeout.current = window.setTimeout(() => {\n          setShowPopover(show);\n        }, delays[show ? showDelay : hideDelay]);\n      } else {\n        setShowPopover(show);\n      }\n    }, [show]);\n\n    useEffect(() => {\n      return () => clearTimeout(timeout.current);\n    }, []);\n\n    useAfterInitialEffect(() => {\n      if (!showPopover) {\n        onHide?.();\n      }\n    }, [showPopover]);\n\n    useEffect(() => {\n      if (groupId && popovers[groupId] && popovers[groupId] !== uid) {\n        setShowPopover(false);\n      }\n    }, [groupId ? popovers[groupId] : undefined]);\n\n    useEffect(() => {\n      if (!portal) return;\n\n      const resolvedTarget = target instanceof Element ? target : target?.contextElement;\n\n      if (!resolvedTarget) return;\n\n      if (!popoverMap.has(resolvedTarget)) {\n        popoverMap.set(resolvedTarget, new Set());\n      }\n\n      if (!resolvedTarget.hasAttribute('data-popover-target')) {\n        resolvedTarget.toggleAttribute('data-popover-target', true);\n      }\n\n      popoverMap.get(resolvedTarget)!.add(pointerId);\n\n      return () => {\n        if (!popoverMap.has(resolvedTarget)) return;\n\n        popoverMap.get(resolvedTarget)!.delete(pointerId);\n\n        if (popoverMap.get(resolvedTarget)!.size === 0) {\n          popoverMap.delete(resolvedTarget);\n          resolvedTarget.removeAttribute('data-popover-target');\n        }\n      };\n    }, [portal, target, pointerId]);\n\n    const content = (\n      <StyledPopover\n        {...restProps}\n        data-popover-id={pointerId}\n        portal={!!(portal && portalTarget)}\n        offset={offset}\n        ref={popperRef}\n        style={{ ...style, ...styles.popper }}\n        {...attributes.popper}\n      >\n        {arrow && <StyledPopoverArrow ref={arrowRef} style={{ ...styles.arrow }} />}\n        <StyledPopoverContent>{children}</StyledPopoverContent>\n      </StyledPopover>\n    );\n\n    if (!target || !showPopover || (groupId && !checkActive(uid, groupId))) return null;\n\n    return portal && portalTarget ? createPortal(content, portalTarget) : content;\n  }\n);\n\nexport default Popover;\n"]}