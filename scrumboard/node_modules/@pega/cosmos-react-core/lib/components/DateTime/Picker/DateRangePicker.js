import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect, useRef } from 'react';
import Flex from '../../Flex';
import MonthInput from '../Input/MonthInput';
import Button from '../../Button';
import Icon, { registerIcon } from '../../Icon';
import * as caretLeftIcon from '../../Icon/icons/caret-left.icon';
import * as caretRightIcon from '../../Icon/icons/caret-right.icon';
import { useConfiguration, useI18n } from '../../../hooks';
import { getCalendarTypeFromLocale, toUTCDateString } from '../Input/utils';
import Calendar from './Calendar';
import Weeks from './Weeks';
import { StyledDatePicker, StyledMonthPicker } from './DatePicker.styles';
import { isValidDate } from './utils';
registerIcon(caretLeftIcon, caretRightIcon);
function toDateString(date) {
    return date ? toUTCDateString(date) : undefined;
}
const DateRangePicker = (props) => {
    const { locale } = useConfiguration();
    const { selected: initial, selectedRange, onChange, min, max, mode, showWeekNumber, ...restProps } = props;
    const [selected, setSelected] = useState(initial);
    const [current, setCurrent] = useState(selected && isValidDate(selected) ? selected : new Date());
    useEffect(() => {
        if (toDateString(initial) !== toDateString(selected)) {
            setSelected(initial);
            setCurrent(initial || new Date());
        }
    }, [toDateString(initial)]);
    const calendarRef = useRef(null);
    useEffect(() => {
        // need to postpone focusing to make sure onFocusWithin has been attached
        setTimeout(() => {
            calendarRef.current?.querySelector('button[tabindex="0"]:enabled')?.focus();
        });
    }, []);
    const calendarType = getCalendarTypeFromLocale(locale);
    const t = useI18n();
    return (_jsxs(StyledDatePicker, { "aria-label": t('calendar'), role: 'region', ...restProps, children: [_jsxs(Flex, { as: StyledMonthPicker, container: { justify: 'between', alignItems: 'center' }, children: [_jsx(Button, { variant: 'simple', icon: true, onClick: () => {
                            const newCurrent = new Date(current);
                            newCurrent.setUTCMonth(newCurrent.getUTCMonth() - 1);
                            setCurrent(newCurrent);
                        }, "aria-label": t('picker_prev_month'), children: _jsx(Icon, { name: 'caret-left' }) }), _jsx(MonthInput, { value: current, required: true, role: 'group', "aria-label": t('picker_jump_to_month_and_year'), onChange: ({ valueAsTimestamp }) => {
                            const newCurrent = new Date(valueAsTimestamp);
                            newCurrent.setUTCDate(current.getUTCDate());
                            setCurrent(newCurrent);
                        }, min: min, max: max }), _jsx(Button, { variant: 'simple', icon: true, onClick: () => {
                            const newCurrent = new Date(current);
                            newCurrent.setUTCMonth(newCurrent.getUTCMonth() + 1);
                            setCurrent(newCurrent);
                        }, "aria-label": t('picker_next_month'), children: _jsx(Icon, { name: 'caret-right' }) })] }), _jsxs(Flex, { container: { wrap: 'nowrap' }, children: [showWeekNumber && _jsx(Weeks, { current: current, calendarType: calendarType, disabled: true }), _jsx(Calendar, { ref: calendarRef, selected: selected && isValidDate(selected) ? selected : undefined, current: current, selectedRange: selectedRange, showHighlight: true, calendarType: calendarType, onFocus: date => {
                            setCurrent(date);
                        }, onSelect: date => {
                            setCurrent(date);
                            setSelected(date);
                            onChange?.(date);
                        }, min: min, max: max })] })] }));
};
export default DateRangePicker;
//# sourceMappingURL=DateRangePicker.js.map