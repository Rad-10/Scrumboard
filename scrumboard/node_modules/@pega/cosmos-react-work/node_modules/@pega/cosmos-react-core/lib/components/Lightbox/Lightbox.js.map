{"version":3,"file":"Lightbox.js","sourceRoot":"","sources":["../../../src/components/Lightbox/Lightbox.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  FunctionComponent,\n  PropsWithoutRef,\n  useEffect,\n  useRef,\n  Ref,\n  useState,\n  forwardRef,\n  MouseEvent,\n  SyntheticEvent\n} from 'react';\n\nimport { ForwardProps } from '../../types';\nimport { cap } from '../../utils';\nimport Flex from '../Flex';\nimport MetaList from '../MetaList';\nimport Icon from '../Icon';\nimport Text from '../Text';\nimport {\n  useConsolidatedRef,\n  useDirection,\n  useEvent,\n  useFocusTrap,\n  useI18n,\n  useScrollToggle\n} from '../../hooks';\nimport ErrorState from '../ErrorState';\n\nimport {\n  StyledHeader,\n  StyledCountTracker,\n  StyledInfo,\n  StyledActionButton,\n  StyledPreviewRegion,\n  StyledNavButton,\n  StyledImageContainer,\n  StyledImage,\n  StyledLiveRegion,\n  StyledLightbox\n} from './Lightbox.styles';\nimport { LightboxProps } from './Lightbox.types';\n\nconst Lightbox: FunctionComponent<LightboxProps & ForwardProps> = forwardRef(\n  (\n    {\n      items,\n      defaultIndex = 0,\n      cycle,\n      onItemLoad,\n      onItemError,\n      onNavigate,\n      onItemDownload,\n      onAfterClose,\n      ...restProps\n    }: PropsWithoutRef<LightboxProps>,\n    refArg: Ref<HTMLDivElement>\n  ) => {\n    const t = useI18n();\n    const { start, end } = useDirection();\n    const [currentIndex, setCurrentIndex] = useState(defaultIndex);\n    const currentItem = items[currentIndex];\n    const { disableScroll, enableScroll } = useScrollToggle();\n    const lightboxRef = useConsolidatedRef(refArg);\n    const headerRef = useRef<HTMLDivElement>(null);\n    const closeButtonRef = useRef<HTMLButtonElement>(null);\n    const prevButtonRef = useRef<HTMLButtonElement>(null);\n    const nextButtonRef = useRef<HTMLButtonElement>(null);\n    const [open, setOpen] = useState(true);\n    const imageRef = useConsolidatedRef(currentItem.ref);\n    const [error, setError] = useState(false);\n    const [liveText, setLiveText] = useState('');\n    const countTrackerText = items.length > 1 ? t('x_of_y', [currentIndex + 1, items.length]) : '';\n\n    const close = () => {\n      setOpen(false);\n    };\n\n    const navigate = (direction: 1 | -1) => {\n      if (direction === 1) {\n        if (currentIndex < items.length - 1) {\n          setCurrentIndex(cur => cur + 1);\n          setError(false);\n        } else if (cycle) {\n          setCurrentIndex(0);\n          setError(false);\n        }\n      } else if (currentIndex > 0) {\n        setCurrentIndex(cur => cur - 1);\n        setError(false);\n      } else if (cycle) {\n        setCurrentIndex(items.length - 1);\n        setError(false);\n      }\n    };\n    const keyDownHandler = (e: KeyboardEvent) => {\n      if (e.repeat) return;\n\n      if (e.key === 'Escape') {\n        close();\n      } else if (e.key === `Arrow${cap(end)}`) {\n        navigate(1);\n      } else if (e.key === `Arrow${cap(start)}`) {\n        navigate(-1);\n      }\n    };\n\n    useEvent('keydown', keyDownHandler);\n    useFocusTrap(lightboxRef);\n\n    useEffect(() => {\n      setLiveText(\n        `${currentItem.name}. ${countTrackerText ? `${countTrackerText}.` : ''} ${\n          currentItem.description\n        }.`\n      );\n    }, [currentItem.name, countTrackerText, currentItem.description]);\n\n    useEffect(() => {\n      lightboxRef.current?.focus();\n    }, []);\n\n    return (\n      <StyledLightbox\n        {...restProps}\n        tabIndex={-1}\n        ref={lightboxRef}\n        open={open}\n        role='dialog'\n        aria-modal='true'\n        container={{ alignItems: 'start', justify: 'start', direction: 'column' }}\n        alpha={0.9}\n        variant='dark'\n        transitionSpeed='slow'\n        onBeforeTransitionIn={disableScroll}\n        onAfterTransitionOut={() => {\n          enableScroll();\n          onAfterClose?.();\n        }}\n      >\n        <Flex\n          as={StyledHeader}\n          ref={headerRef}\n          container={{\n            justify: 'between',\n            alignItems: 'center',\n            gap: 2\n          }}\n          onMouseDown={(e: MouseEvent<HTMLDivElement>) => {\n            if (e.button !== 0) return;\n            if (e.target === e.currentTarget) close();\n          }}\n        >\n          <StyledCountTracker aria-hidden='true'>{countTrackerText}</StyledCountTracker>\n\n          <Flex\n            as={StyledInfo}\n            container={{\n              wrap: 'wrap',\n              alignItems: 'center',\n              justify: 'center',\n              colGap: 2,\n              rowGap: 0.5\n            }}\n          >\n            <Text variant='primary' as='h2'>\n              {currentItem.name}\n            </Text>\n            {currentItem.metadata && <MetaList items={currentItem.metadata} />}\n          </Flex>\n\n          <Flex container>\n            {onItemDownload && (\n              <StyledActionButton\n                variant='simple'\n                aria-label={t('download')}\n                icon\n                onClick={() => onItemDownload(currentItem.id)}\n              >\n                <Icon name='download' />\n              </StyledActionButton>\n            )}\n            <StyledActionButton\n              variant='simple'\n              ref={closeButtonRef}\n              aria-label={t('close')}\n              icon\n              onClick={close}\n            >\n              <Icon name='times' />\n            </StyledActionButton>\n          </Flex>\n        </Flex>\n\n        <Flex\n          container={{ justify: 'between' }}\n          as={StyledPreviewRegion}\n          item={{ grow: 1, shrink: 0 }}\n        >\n          {items.length > 1 && (\n            <StyledNavButton\n              ref={prevButtonRef}\n              variant='simple'\n              aria-label={t('pagination_prev')}\n              hidden={!cycle && currentIndex === 0}\n              icon\n              onClick={() => {\n                navigate(-1);\n              }}\n            >\n              <span>\n                <Icon name='caret-left' />\n              </span>\n            </StyledNavButton>\n          )}\n\n          <Flex item={{ grow: 1 }} as={StyledImageContainer}>\n            <Flex\n              container={{ alignItems: 'center' }}\n              onMouseDown={(e: MouseEvent<HTMLDivElement>) => {\n                if (e.button !== 0) return;\n                if (e.target === e.currentTarget) close();\n              }}\n            >\n              {error ? (\n                <ErrorState message={t('image_load_error')} />\n              ) : (\n                <StyledImage\n                  ref={imageRef}\n                  src={currentItem.src}\n                  alt={currentItem.description}\n                  onLoad={(e: SyntheticEvent<HTMLImageElement>) => {\n                    onItemLoad?.(currentItem.id, e);\n                  }}\n                  onError={(e: SyntheticEvent<HTMLImageElement>) => {\n                    onItemError?.(currentItem.id, e);\n                    setError(true);\n                  }}\n                />\n              )}\n            </Flex>\n          </Flex>\n\n          {items.length > 1 && (\n            <StyledNavButton\n              ref={nextButtonRef}\n              variant='simple'\n              aria-label={t('pagination_next')}\n              hidden={!cycle && currentIndex === items.length - 1}\n              icon\n              onClick={() => {\n                navigate(1);\n              }}\n            >\n              <span>\n                <Icon name='caret-right' />\n              </span>\n            </StyledNavButton>\n          )}\n        </Flex>\n        <StyledLiveRegion aria-live='polite' aria-label={liveText} />\n      </StyledLightbox>\n    );\n  }\n);\n\nexport default Lightbox;\n"]}